/*!
 * typeahead.js 0.11.1
 * https://github.com/twitter/typeahead.js
 * Copyright 2013-2015 Twitter, Inc. and other contributors; Licensed MIT
 */
!function(a,b){"object"==typeof exports&&"undefined"!=typeof module?module.exports=b():"function"==typeof define&&define.amd?define(b):a.typeahead=b()}(this,function(){var define,module,exports;return function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r}()({1:[function(require,module,exports){var $=require("jquery"),EventEmitter=require("eventemitter3"),Utils=require("./utils"),Dataset=require("./dataset"),Menu=require("./menu"),Input=require("./input"),Html=require("./html"),Css=require("./css");var Typeahead=function(o,datasets){var that=this;this.$node=$(o),this.datasets=datasets||[],this.eventBus=new EventEmitter,this.isActivated=!1,this.isOpen=!1,this.isDestroyed=!1,this.query=null,this.suggestions=[],this.selected=null,this.activated=null,this.autocomplete=null,this.minLength=2,this.maxLength=Infinity,this.openOnFocus=!1,this.accentDiacritics=!0,this.highlight=!0,this.hint=!0,this.classNames={open:"tt-open",cursor:"tt-cursor",highlight:"tt-highlight",dataset:"tt-dataset",suggestion:"tt-suggestion",selectable:"tt-selectable",query:"tt-query",hint:"tt-hint",empty:"tt-empty",spinner:"tt-spinner"},this.$node.one("blur.typeahead",function(){that.isActivated=!0}),this._setDefaults(),this._bindEvents(),this._addHtmlStructure(),this._initializeDatasets()};Typeahead.prototype={_setDefaults:function(){var that=this;$.each(this.datasets,function(i,dataset){var o=dataset;o.highlight=o.highlight!==undefined?o.highlight:that.highlight,o.hint=o.hint!==undefined?o.hint:that.hint,o.minLength=o.minLength!==undefined?o.minLength:that.minLength,o.maxLength=o.maxLength!==undefined?o.maxLength:that.maxLength,o.name=o.name||"dataset_"+i,o.source=o.source||function(){},o.templates=o.templates||{},o.templates.notFound=o.templates.notFound||function(){return"<div class='"+that.classNames.empty+"'>No results found</div>"},o.templates.pending=o.templates.pending||function(){return"<div class='"+that.classNames.spinner+"'>Searching...</div>"},o.templates.header=o.templates.header||function(){return null},o.templates.footer=o.templates.footer||function(){return null},o.templates.suggestion=o.templates.suggestion||function(datum){return"<div class='"+that.classNames.suggestion+"'>"+datum.value+"</div>"}}),this.minLength=Math.min.apply(Math,this.datasets.map(function(o){return o.minLength})),this.maxLength=Math.max.apply(Math,this.datasets.map(function(o){return o.maxLength}))},_bindEvents:function(){var that=this;this.$node.on("blur.typeahead",function(e){var activeElement=document.activeElement;setTimeout(function(){if(activeElement===document.activeElement){that.isOpen&&that._close()}},150)}).on("focus.typeahead",function(){that.isActivated&&that.openOnFocus&&that._open()}).on("keydown.typeahead",function(e){that._onKeydown(e)}).on("input.typeahead",function(){that._onInput()})},_onKeydown:function(e){var keyName=Utils.getNameFromEvent(e);if(this.isDestroyed)return;switch(keyName){case"esc":this.isOpen&&(Utils.preventDefault(e),this._close());break;case"tab":this.isOpen&&this.activated&&(Utils.preventDefault(e),this._select(this.activated));break;case"enter":this.isOpen&&this.activated?(Utils.preventDefault(e),this._select(this.activated)):this.isOpen&&this._getSuggestions().length&&(Utils.preventDefault(e),this._select(this._getSuggestions()[0]));break;case"up":case"down":this.isOpen?(Utils.preventDefault(e),this._moveCursor(keyName==="up"?"prev":"next")):this._open()}},on:function(type,handler){return this.eventBus.on(type,handler),this},off:function(type,handler){return this.eventBus.off(type,handler),this},trigger:function(type,args){return this.eventBus.trigger(type,args),this},open:function(){this._open()},close:function(){this._close()},val:function(newVal){return newVal!==undefined?(this.$node.val(newVal),this):this.$node.val()},destroy:function(){this.isDestroyed=!0,this.$node.off(".typeahead"),this.$node.removeData("typeahead"),this.eventBus.removeAllListeners(),this.$node=null,this.datasets=null,this.suggestions=null,this.selected=null,this.activated=null,this.autocomplete=null},_onInput:function(){var query=this.$node.val();this.query=query,this._search(query)},_search:function(query){var that=this;if(query.length<this.minLength||query.length>this.maxLength)return this._close();this.isOpen||this._open(),this._getSuggestions().length?this._render():this._hide(),this.eventBus.trigger("render",this.suggestions,this.datasets),this.eventBus.trigger("cursorchange"),this.eventBus.trigger("asyncrequest",query),this._cancelAsyncRequests(),this._getAsyncSuggestions(query,function(suggestions){that._updateSuggestions(suggestions),that._render(),that.eventBus.trigger("render",that.suggestions,that.datasets),that.eventBus.trigger("cursorchange"),that.eventBus.trigger("asyncreceive",query)})},_getAsyncSuggestions:function(query,callback){var that=this,asyncCounter=0,asyncRequests=0;$.each(this.datasets,function(i,dataset){var queryLength=query.length;if(queryLength>=dataset.minLength&&queryLength<=dataset.maxLength){asyncRequests++,dataset.source(query,function(suggestions){asyncCounter++,that.suggestions=that.suggestions.concat(suggestions),asyncCounter===asyncRequests&&callback(that.suggestions)})}})},_cancelAsyncRequests:function(){$.each(this.datasets,function(i,dataset){dataset.source&&dataset.source.cancel&&dataset.source.cancel()})},_getSuggestions:function(){return this.suggestions},_updateSuggestions:function(suggestions){this.suggestions=suggestions},_render:function(){var that=this;this.$menu.html(this._getHtml()),this._show(),this.eventBus.trigger("rendered")},_getHtml:function(){var that=this,html="";return $.each(this.datasets,function(i,dataset){var suggestions=that._getDatasetSuggestions(dataset),hasHeader=dataset.templates.header,hasFooter=dataset.templates.footer,headerHtml=hasHeader?dataset.templates.header(suggestions,dataset):"",footerHtml=hasFooter?dataset.templates.footer(suggestions,dataset):"",suggestionsHtml=that._getSuggestionsHtml(suggestions,dataset);html+=headerHtml+suggestionsHtml+footerHtml}),html},_getDatasetSuggestions:function(dataset){return this.suggestions.filter(function(suggestion){return suggestion.dataset===dataset.name})},_getSuggestionsHtml:function(suggestions,dataset){var that=this,html="";return suggestions.length?($.each(suggestions,function(i,suggestion){html+=that._getSuggestionHtml(suggestion,dataset)}),html):dataset.templates.notFound?dataset.templates.notFound():""},_getSuggestionHtml:function(suggestion,dataset){var $suggestion=$(dataset.templates.suggestion(suggestion,dataset));return $suggestion.attr("data-value",suggestion.value),$suggestion.attr("data-dataset",suggestion.dataset),$suggestion.addClass(this.classNames.selectable),$suggestion[0].outerHTML},_moveCursor:function(direction){var suggestions=this._getSuggestions(),activated=this.activated,index;if(!suggestions.length)return;index=activated?suggestions.indexOf(activated):-1,index=Utils.moveCursor(index,direction,suggestions.length),this.activated=suggestions[index],this._updateCursor(),this.eventBus.trigger("cursorchange")},_updateCursor:function(){var $suggestions=this.$menu.find("."+this.classNames.selectable);$suggestions.removeClass(this.classNames.cursor),this.activated&&$suggestions.filter("[data-value='"+this.activated.value+"']").addClass(this.classNames.cursor)},_select:function(activated){var selected=this.selected=activated;this.query=selected.value,this.$node.val(this.query),this._close(),this.eventBus.trigger("selected",selected)},_show:function(){this.$menu.show(),this.isOpen=!0,this.eventBus.trigger("opened")},_hide:function(){this.$menu.hide()},_open:function(){this.isOpen||(this.$menu.show(),this.isOpen=!0,this.eventBus.trigger("opened"))},_close:function(){this.isOpen&&(this.$menu.hide(),this.isOpen=!1,this.activated=null,this.eventBus.trigger("closed"))},_addHtmlStructure:function(){var $wrapper, $menu;this.$node.wrap($wrapper=$("<div>",{class:this.classNames.dataset})),this.$menu=$menu=$("<div>",{class:this.classNames.menu}),$wrapper.append($menu),this.$menu=$menu},_initializeDatasets:function(){var that=this;$.each(this.datasets,function(i,dataset){new Dataset(dataset,that)})}};return Typeahead.prototype.constructor=Typeahead,Typeahead}()),"undefined"!=typeof module&&module.exports?module.exports=Typeahead:"function"==typeof define&&define.amd?define("typeahead",[],function(){return Typeahead}):root.typeahead=Typeahead,root.Bloodhound=Bloodhound}(this);
